---
layout: post
title: Elixi数据结构访问和Access模块
categories: elixir
---

## 数据访问

Elixir提供了两种语法来访问数据结构中的元素。  
使用`user[:name]`访问动态数据结构的元素，如`maps` 和 `keywords`。中括号中的`:name`可以是一个变量。
使用`user.name`访问struct等静态数据结构的元素。  
两种方式的主要区别是当属性不存在时`user[:name]`不会抛出异常，但`user.name`会抛出异常。


### 访问maps元素

```elixir
user = %{name: "Alice", age: 21}

user[:name]     # Alice
user.name       # Alice

field = :age
user[field]     # 21    # 可以是变量，这就是为什么叫动态访问的原因

user[:birth]    # nil

user.birth      # (KeyError) key :birth not found in: %{age: 21, name: "Alice"}
```

### 访问keywords元素

```elixir
opts = [timeout: 1000, delay: true]   ## 相当于 [{:timeout, 1000}, {:delay, true}]
opts[:timeout]    # 1000

# keywords 不能这么访问
opts.timeout      # ** (ArgumentError) argument error   
```

### 访问struct元素

```elixir
defmodule User do
  defstruct [:name, :age]
end

user = %User{user: "Bob", age: 21}
user.name     # Bob
user.age      # 21

user[:name]
# ** (UndefinedFunctionError) function User.fetch/2 is undefined (User does not implement the Access behaviour)
```

## Access

Access是一个behavior，实现它的数据结构就可以支持`data[:name]`这种方式访问。  
如上面示例中由于User没有实现`Access`behavoir，所以不能使用中括号语法来访问。  
