---
layout: post
title: Elixir Style Guide
categories: elixir
---

参考 [Elixir Guide Style](https://github.com/christopheradams/elixir_style_guide)


## 源代码格式

### 使用两个空格缩进，不使用Tab字符。


```elixir
def some_function do
  do_something
end
```

### 以下位置需要添加空格。

1. 操作符左右
2. 逗号分号和冒号后面
3. 模式匹配不加空格，如大括号和中括号的两端。

```elixir
sum = 1 + 2
{a, b} = {2, 3}
[first | rest] = [1, 2, 3]
Enum.map(["one", <<"two">>, "three"], fn num -> IO.puts num end)
```

### 一元操作符后不要加空格，range操作符左右也不要加空格。

```elixir
0 - 1 == -1
^pinned = some_func()
5 in 1..10
```

### def定义的函数之间使用空行分开，用于表达逻辑的独立性。


### 但是单行函数之间不要有空行。

```elixir
def some_function(nil), do: {:err, "No Value"}
def some_function([]), do: :ok
def some_function([first | rest]) do
  some_function(rest)
end
```

### 如果使用`do:`定义的函数，如果函数体太长，把`do:`另起一行，并且适当缩进。

```elixir
def some_function(args),
  do: Enum.map(args, fn(arg) -> arg <> " is on a very long line!" end)
```


### 如果使用do:定义函数，且有多个函数体，`do:`需要另起一行。

```elixir
# not preferred
def some_function([]), do: :empty
def some_function(_),
  do: :very_long_line_here

# preferred
def some_function([]),
  do: :empty
def some_function(_),
  do: :very_long_line_here
```


### 一行以上的函数体不要使用`do:`定义。


### 使用`|>`连接函数链式调用。

1. 链式调用优先使用 `pipe operator`
2. 多行`pipelines`不缩进
3. `=`右边的`pipelines`需要整体换行且缩进

```elixir
# not preferred
String.strip(String.downcase(some_string))

# preferred
some_string |> String.downcase |> String.strip

# Multiline pipelines are not further indented
some_string
|> String.downcase
|> String.strip

# Multiline pipelines on the right side of a pattern match
# should be indented on a new line
sanitized_string =
  some_string
  |> String.downcase
  |> String.strip
```


### 一个参数的函数调用就不要使用管道操作符了。

```elixir
# not preferred
some_string |> String.downcase

# preferred
String.downcase(some_string)
```


### 使用纯净的变量作为链式调用的开始。

```elixir
# THE WORST!
# This actually parses as String.strip("nope" |> String.downcase).
String.strip "nope" |> String.downcase

# not preferred
String.strip(some_string) |> String.downcase |> String.codepoints

# preferred
some_string |> String.strip |> String.downcase |> String.codepoints
```

## 语法


