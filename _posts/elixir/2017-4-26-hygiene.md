---
layout: post
title: 宏的卫生问题
categories: elixir
---

宏是一种将代码注入到调用端的技术，使用这种技术可以完成一些常规流程之外的任务，比如可以自定义控制流程等。  

Elixir中的宏是卫生的（官方说话是hygiene），我是第一次在编程的语境中看到这个词，觉得很不可思议。其背后的思想是：宏注入的代码应该是清洁和无污染的。  

这种设计一方面避免不小心造成的名字冲突，另一方面迫使我们明确地进入或使用调用者的上下文，这和Elixir总体的设计理念是一致的，清晰、明确、无歧义，为此可以牺牲一些美观，允许存在一些无害的重复。

以下示例演示了宏中定义的变量对于调用端是不可见的。


```elixir
defmodule Hygiene do
  defmacro no_interference do
    quote do
      a = 1
    end
  end
end


defmodule HygieneTest do
  require Hygiene
  def go do
    a = 13
    Hygiene.no_interference
    a
  end
end


HygieneTest.go
# 13
```

以上示例中，宏中的定义的`a`变量并不会影响到调用端的代码，即两个`a`是不同的。

